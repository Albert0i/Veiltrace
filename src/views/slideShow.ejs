<!DOCTYPE html>
<html>
<head>
  <title><%= title %> â€” Slideshow</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    img { display: block; margin: auto; max-width: 100vw; max-height: 100vh; transition: opacity 0.5s ease; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; color: white;
      font-family: sans-serif; padding: 1rem; background: rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
  <img id="slideshow-image" src="" alt="Slideshow Image">

  <script type="text/javascript">
    const imageIds = <%= JSON.stringify(imageIds) %>;     // Array of image IDs for slideshow
    const baseUrl = '/api/v1/image/view/';                // Base API endpoint for full-size images
    const images = imageIds.map(id => `${baseUrl}${id}`); // Construct full image URLs
  
    let index = 0;                  // Current image index
    let paused = false;             // Whether slideshow is paused
    let interval = <%= interval %>; // Time between slides (in ms)
    let timer;                      // Reference to interval timer
  
    const img = document.getElementById('slideshow-image'); // DOM reference to image element
  
    function showImage() {
      img.style.opacity = 0;      // Fade out current image
      setTimeout(() => {
        img.src = images[index];  // Set new image source
        img.style.opacity = 1;    // Fade in new image
      }, 100);                    // Delay to allow fade-out
    }
  
    function nextImage() {
      index = (index + 1) % images.length;  // Advance index, wrap around
      showImage();                          // Display updated image
    }
  
    function prevImage() {
      index = (index - 1 + images.length) % images.length; // Decrement index, wrap around
      showImage(); // Display updated image
    }
  
    function startLoop() {
      timer = setInterval(() => {
        if (!paused) nextImage(); // Advance only if not paused
      }, interval); // Repeat every interval ms
    }
  
    function stopLoop() {
      clearInterval(timer); // Cancel interval timer
    }
  
    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case ' ': paused = !paused; break; // Space toggles pause/resume
        case 'Escape': window.close(); break; // Esc closes slideshow window
        case 'ArrowRight': nextImage(); break; // Right arrow moves forward
        case 'ArrowLeft': prevImage(); break; // Left arrow moves backward
      }
    });
  
    showImage(); // Show first image
    startLoop(); // Begin looping slideshow
  </script>
</body>
</html>